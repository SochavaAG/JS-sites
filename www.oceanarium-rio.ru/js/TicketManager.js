function TicketManager(){this.CommandUrlWithParametersTemplate="{CommandURL}?command={Action}&ReturnURL={ReturnURL}{AdditionalParams}",this.WidgetFrameTemplate='<iframe id="frame_{FrameID}" class="afisha-id-iframe widget_frame__iframe" src="{CommandURLWithParameters}" style="display: none;" scrolling="no" frameborder="0" allowTransparency="true" onload="onFrameLoad()"></iframe>',this.Widget2FrameTemplate='<iframe id="frame_{FrameID}" width="980" height="620" class="widget_2_iframe" name="widget_2_iframe" src="{CommandURLWithParameters}" scrolling="no" frameborder="0" allowTransparency="true" onload="onFrameLoad()"></iframe>'}function onFrameLoad(){var e=document.getElementById("afishaOverlay");!function(e,t,a){void 0!==e.attachEvent?e.attachEvent("on"+t,a):void 0!==e.addEventListener&&e.addEventListener(t,a,!1)}(e,"click",function(){window.frames.widget_2_iframe.postMessage({id:"kassa-widget-wants-to-disappear"},"*")}),e&&(e.className="",document.getElementById(ticketManager.FrameID).className+="v1"==ticketManager.widgetVersion?" widget_1_frame":" widget_2_frame")}!function(e,t,a){var n={hasClass:function(e,t){var a=e.className;return!!new RegExp("\\s?\\b"+t+"\\b","g").test(a)},addClass:function(e,t){var a=e.className;-1==a.indexOf(t)&&(""!=a&&(t=" "+t),e.className=a+t)},removeClass:function(e,t){var a=e.className,n=new RegExp("\\s?\\b"+t+"\\b","g");return a=a.replace(n,""),e.className=a,e},toggleClass:function(e,t){if(e&&t){var a=e.className,n=a.indexOf(t);-1==n?a+=" "+t:a=a.substr(0,n)+a.substr(n+t.length),e.className=a}},createElement:function(e,a){a=a||{};var n=t.createElementNS?t.createElementNS("http://www.w3.org/1999/xhtml",e):t.createElement(e);return this.attrs(n,a),n},attrs:function(e,t){for(var a in t)this.attr(e,a,t[a]);return e},attr:function(e,t,a){if(t={for:"htmlFor",class:"className"}[t]||t,!a)return e[t]||e.getAttribute(t)||"";"style"!=t?("class"==t&&(e.classList?e.classList.add(a):e.className+=" "+a),e[t]=a,e.setAttribute&&e.setAttribute(t,a)):e.style.cssText=a},getWindowSize:function(e,a){return{width:parseInt(window.innerWidth||t.documentElement.clientWidth)-2*(e||0),height:parseInt(window.innerHeight||t.documentElement.clientHeight)-2*(a||0)}},getWindowYCenter:function(e){var a=void 0!==window.pageYOffset?window.pageYOffset:(t.documentElement||t.body.parentNode||t.body).scrollTop,n=this.getWindowSize().height;return n=n<e?e:parseInt(n),Math.ceil(a+n/2)},debounce:function(e,t,a){var n;return function(){var i=this,r=arguments;clearTimeout(n),n=setTimeout(function(){n=null,a||e.apply(i,r)},t),a&&!n&&e.apply(i,r)}},removeElement:function(e){e.parentNode.removeChild(e)}};e.tmH=n}(this,this.document),TicketManager.prototype={FrameID:null,CommandURL:null,ReturnURL:null,CookieDomain:null,widgets:null,customLoader:null,maxRequestLength:2e3,CONCERT_CLASS_ID:4,PERFORMANCE_CLASS_ID:9,MOVIE_CLASS_ID:17,EVENT_CLASS_ID:30,SPORTEVENT_CLASS_ID:65,orderKeyParam:"AFISHA_PARAM_ORDERKEY",creationTypeParam:"AFISHA_CREATION_TYPE",widgetVersion:"v1",utmParameters:{source:"",medium:"",campaign:"",term:"",content:""},cookieValue:void 0,environmentParams:{authCookie:void 0},onClose:{success:function(){},close:function(){}},InitDialog:function(e,t){var a=document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css";var i='@keyframes rotation-animation { 0% {transform: rotate(0deg)} to {transform: rotate(360deg)};}#afishaOverlay { position:fixed; top:0; bottom:0; right:0; left:0; z-index: 65010; background:rgba(0,0,0,0.68);}#afishaOverlay.animated_overlay:after { content:""; display:block; position:fixed; background:url("data:image/png;base64,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") 50% no-repeat; background-size: contain; top:50%; left:50%; width:72px; height:72px; margin: -36px 0 0 -36px; animation: rotation-animation 1s infinite linear;}.g-simple-button { display: block;position: absolute; z-index:3000; top: 13px;right: 16px;height: 19px;width: 19px;padding: 0;line-height: 10px;text-indent: -999em;cursor: pointer;box-shadow: 0 1px 0 #CCC;-moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);-webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);border: 1px solid #CCC;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;background: #F5F5F6;background: -moz-linear-gradient(top, white, #EEEEF0);background: -webkit-linear-gradient(top, white, #EEEEF0);background: -o-linear-gradient(top, white, #EEEEF0);background: -ms-linear-gradient(top, white, #EEEEF0);background: linear-gradient(top, white, #EEEEF0);filter: progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr="#ffffff", EndColorStr="#eeeef0");text-align: center;font-size: 11px;color: #666;}.g-simple-button:hover { border: 1px solid #FF781A;}.g-simple-button__close { font:bold 16px/18px Tahoma, sans-serif; text-decoration:none; color:#666; text-indent:0; vertical-align:top;}.g-simple-button__close:hover { color:#666; text-decoration:none;}.g-simple-button__img { display: block; margin: 5px auto 0px;}.widget_frame { opacity:0; position:fixed; top:50%; left:50%; z-index: 65011;}.widget_frame.widget_1_frame { opacity:1; display:block; background: #bcbfc6; border:9px solid rgba(223,223,223,0.5); box-shadow:0 0 30px -5px #000; overflow:hidden; -webkit-overflow-scrolling:touch; -moz-box-sizing:border-box; -webkit-box-sizing:border-box; box-sizing:border-box;}.widget_frame__iframe { width:100% !important; height:100% !important; display:block;}.widget_content_popup { position:fixed; position:device-fixed; top:50%; left:50%; z-index:65012; width:0; height:0; background:rgba(0,0,0, 0.44); display:none; }.widget_content_popup_in { overflow:auto; overflow:hidden; -webkit-box-shadow:0 0 30px -5px #000; -moz-box-shadow 0 0 30px -5px #000; box-shadow:0 0 30px -5px #000; border:9px solid #eee; border:9px solid rgba(223,223,223, 0.5); margin:-9px;}.widget_content_popup__img { max-width:100%; height:auto; vertical-align:top; }.widget_content_popup_full .widget_content_popup_in { overflow:auto;}.widget_content_popup_full .widget_content_popup__img { width:auto; height:auto; }.widget_frame.widget_2_frame { opacity:1; margin: auto; top: 0; bottom: 0; left: 0; right: 0; display:block; background: #25272d; z-index:65011; -moz-box-sizing:border-box; -webkit-box-sizing:border-box; box-sizing:border-box; width:980px; height:620px}iframe.widget_2_iframe { width:980px; height:620px; display:block;}.widget_frame.widget_2_frame iframe { visibility:visible;}';n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i)),a.appendChild(n),this.popupMinWidth=700,this.popupMinHeight=528,this.popupMaxWidth=1330,this.popupMaxHeight=1e3,this.popupBorderWidth=9,this.popupWidth=e,this.popupHeight=t,this.afPopup=document.getElementById(ticketManager.FrameID),this.afPopup.className+=" widget_frame",this.UpdateDialogPosition()},UpdateDialogPosition:function(){var e,t=this.afPopup,a=this.getPopupSizes();t&&"v1"==ticketManager.widgetVersion&&((e=t.style).width=a.width,e.height=a.height,e.marginLeft=a.marginLeft,e.marginTop=a.marginTop,e.display="block")},isMobileDevice:function(){return window.innerWidth<980},getPopupSizes:function(){var e=tmH.getWindowSize(),t="100%"==this.popupWidth?e.width:this.popupWidth,a="100%"==this.popupHeight?e.height:this.popupHeight,n=t/2,i=a/2;return{width:t+"px",height:a+"px",marginLeft:-Math.round(n)+"px",marginTop:-Math.round(i)+"px"}},Execute:function(e){ticketManager.load();var t;switch(e.Name){case"command":this.commandFunction(e);break;case"setStyle":if(t=document.getElementById("frame_"+ticketManager.FrameID),e.Args&&"v1"==ticketManager.widgetVersion)for(var a in e.Args)t.style[a]=e.Args[a];t.style.display="block",void 0!==e.Args.width&&"v1"==ticketManager.widgetVersion&&(t.style.left=(document.body.clientWidth-parseInt(e.Args.width))/2),void 0!==e.Args.height&&"v1"==ticketManager.widgetVersion&&(t.style.top=(document.body.clientHeight-parseInt(e.Args.height))/2);break;case"getUrl":(t=document.getElementById("frame_"+ticketManager.FrameID)).src=e.Args.URL+"#"+escape(location.href);break;case"redirect":var n="";if(location.href.indexOf("#")>-1&&(n=location.href.split("#")[1]),UrlRemoveHash(location.href)!=e.Args.RedirectURL){i=e.Args.RedirectURL;n.length>0&&(i=i+"#"+n),location.replace(i)}else{var i=getUrlWithoutHash(e.Args.RedirectURL);n.length>0&&(i=i+"#"+n),location=i}break;case"refresh":location.reload();break;case"setCookie":e.Args.Expires?(exdate=new Date,exdate.setDate(exdate.getDate()+1*e.Args.Expires),document.cookie=e.Args.Name+"="+escape(e.Args.Value)+(null==e.Args.Expires?"":";expires="+exdate.toGMTString())+(ticketManager.CookieDomain?";domain="+ticketManager.CookieDomain:"")+";path=/"):document.cookie=e.Args.Name+"="+escape(e.Args.Value)+(ticketManager.CookieDomain?";domain="+ticketManager.CookieDomain:"")+";path=/";break;case"hide":var r=document.getElementById(ticketManager.FrameID),o=document.getElementById("afishaOverlay");r&&r.parentNode&&r.parentNode.removeChild(r),o&&o.parentNode&&o.parentNode.removeChild(o);break;case"package":for(var a in e.Args)ticketManager.Execute(e.Args[a]);break;case"open":ticketManager.openWidget(e.Args.key,e.Args.movieName,e.Args.cityName);break;case"cinemaSchedule":ticketManager.cinemaSchedule(e.Args.key,e.Args.cinemaID);break;case"showImagePopup":ticketManager.showImagePopup(e.Args.url);break;case"session":ticketManager.session(e.Args.key,e.Args.sessionID);break;case"close":document.getElementById(ticketManager.FrameID).style.display="none",document.getElementById("afishaOverlay").style.display="none",ticketManager.removeOrderKeyParam(),ticketManager.dispatchEvent("ticketmanager.events.close"),e.Args||(e.Args={}),e.Args.success&&ticketManager.onClose.success({orderKey:e.Args.orderKey}),ticketManager.onClose.close({success:e.Args.success,orderKey:e.Args.orderKey}),tmH.removeElement(document.getElementById(ticketManager.FrameID));break;case"setHeight":var c=ticketManager.getWidgetByKey(e.Args.key),s=document.getElementsByName("widget"+c.Uid),d=e.Args.height;s[0].style.height=d+"px";break;case"loaded":onFrameLoad()}},getWidgetVersion:function(e,t,a){var n={type:null,body:null},i=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest),r={};i.open("GET",e),i.withCredentials=!0,i.onload=function(){var e,i,o;r=JSON.parse(this.responseText),ticketManager.widgetVersion=r.widgetVersion,t?a?(n.type="link",n.body=r.widgetUrl,a(n)):(e=r.widgetUrl,(i=window[window.GoogleAnalyticsObject])&&window.gaplugins&&(o=i.getAll()[0],e=new window.gaplugins.Linker(o).decorate(r.widgetUrl)),window.top.location=e):a?(n.type="fn",n.body=function(){ticketManager.loadPopupFrame(r.widgetUrl)},a(n)):ticketManager.loadPopupFrame(r.widgetUrl)},i.onerror=function(){return this.status},i.send(null)},commandFunction:function(e){var t,a="",n=ticketManager.isMobileDevice()&&!0===e.IsMobileVersionSupported,i=e.returnUrlCallBack;if(ticketManager.Execute({Name:"hide"}),null!=e.Args.AdditionalParams){for(var r=new Array,o=0;o<e.Args.AdditionalParams.length;o++){var c=new Array;c.push(e.Args.AdditionalParams[o].name),c.push(e.Args.AdditionalParams[o].value),r.push(c.join("="))}r.length>0&&(a="&"+r.join("&"))}n&&(a+="&devicetype=mobile"),t=ticketManager.CommandUrlWithParametersTemplate.replace("{CommandURL}",ticketManager.CommandURLWidget).replace("{Action}",e.Args.Action).replace("{AdditionalParams}",a).replace("{ReturnURL}",e.Args.ReturnURL?escape(e.Args.ReturnURL):escape(ticketManager.ReturnURL)),ticketManager.getWidgetVersion(t,n,i)},loadPopupFrame:function(e){var t,a,n,i,r,o=e,c=window[window.GoogleAnalyticsObject];c&&window.gaplugins&&(r=c.getAll()[0],o=new window.gaplugins.Linker(r).decorate(e)),t=("v1"===ticketManager.widgetVersion?ticketManager.WidgetFrameTemplate:ticketManager.Widget2FrameTemplate).replace("{CommandURLWithParameters}",o).replace("{FrameID}",ticketManager.FrameID),(a=document.createElement("div")).innerHTML+=t,a.setAttribute("id",ticketManager.FrameID),n=tmH.createElement("div",{id:"afishaOverlay",class:"animated_overlay"}),(i=document.body).appendChild(n),i.appendChild(a),ticketManager.initDialogAndSetStyle()},popupContentSizes:function(e,t){var a=tmH.getWindowSize(20,20),n=e/t,i=a.width,r=a.height;return i/r>n?t<=r?(r=t,i=t*n):i=parseInt(r*n):e<=i?(i=e,r=e/n):r=parseInt(i/n),{width:i,height:r}},resetContentBlock:function(e,t){return e.innerHTML='<a href="javascript:ticketManager.closeImagePopup(&quot;'+t+'&quot;);" class="g-simple-button g-simple-button__close s-close-button">&times;</a><div id="'+t+'_content" class="widget_content_popup_in"></div>',tmH.removeClass(e,"widget_content_popup_full"),e},createContentBlock:function(e){var t=document.getElementById(e);return t||(t=tmH.createElement("div",{id:e,class:"widget_content_popup"}),document.getElementsByTagName("body")[0].appendChild(t)),ticketManager.resetContentBlock(t,e)},centerContentBlock:function(e,t,a){return e.style.width=t,e.style.height=a,e.style.marginLeft="-"+parseInt(t)/2+"px",e.style.marginTop="-"+parseInt(a)/2+"px",e},showImagePopup:function(e){var t=new Image;t.onload=function(){var a=ticketManager.createContentBlock("ticketManagerImageContainer"),n=document.getElementById("ticketManagerImageContainer_content"),i=ticketManager.popupContentSizes(this.width,this.height);a.style.width=i.width+"px",a.style.height=i.height+"px";var r={class:"widget_content_popup__img",style:"width:"+i.width+"px;height:"+i.height+"px;max-width:"+this.width+"px;max-height:"+this.height+"px;"};t=tmH.attrs(t,r);var o=tmH.createElement("a",{href:e,target:"_blank"});o.appendChild(t),n.appendChild(o),n.onclick=function(){tmH.toggleClass(n,"widget_content_popup_full"),tmH.hasClass(n,"widget_content_popup_full")?(tmH.removeClass(n,"widget_content_popup_full"),n.style.cssText=""):tmH.addClass(n,"widget_content_popup_full")},a.style.display="block",ticketManager.centerContentBlock(a,i.width,i.height)},t.onerror=function(){},t.src=e,t.style.display="block"},createZoom:function(){},closeImagePopup:function(e){document.getElementById(e).style.display="none"},zoomImagePopup:function(e){tmH.toggleClass(document.getElementById(e),"widget_content_popup_full")},removeOrderKeyParam:function(){var e=ticketManager.getUrlVar(ticketManager.orderKeyParam);if(null!=e&&""!=e){var t=ticketManager.getUrlVar(ticketManager.creationTypeParam),a=location.href;a=ticketManager.removeUrlParam(a,ticketManager.orderKeyParam,e),a=ticketManager.removeUrlParam(a,ticketManager.creationTypeParam,t),location.href=a}},removeUrlParam:function(e,t,a){return e=e.replace("&"+t+"="+a,""),e=e.replace(t+"="+a,""),e="?"==e.slice(-1)?e.replace("?",""):e.replace("?&","?")},getUrlVars:function(){for(var e,t=[],a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<a.length;n++)e=a[n].split("="),t.push(e[0]),t[e[0]]=e[1];return t},getUrlVar:function(e){return ticketManager.getUrlVars()[e]},getWidgetByUid:function(e){for(var t=0;t<ticketManager.widgets.length;t++)if(ticketManager.widgets[t].Uid==e)return ticketManager.widgets[t];return null},getWidgetByKey:function(e){for(var t=0;t<ticketManager.widgets.length;t++)if(ticketManager.widgets[t].getAttribute("key")==e)return ticketManager.widgets[t];return null},setMovieWidget:function(e,t,a,n,i,r,o){ticketManager.setWidget(e,t,i,r,o)},setScheduleWidget:function(e,t,a,n,i){ticketManager.setWidget(e,t,a,n,i)},setCinemaWidget:function(e,t,a,n,i,r){ticketManager.setWidget(e,t,n,i,r)},setListWidget:function(e,t,a,n,i){ticketManager.setWidget(e,t,a,n,i)},setInlineScheduleWidget:function(e,t,a,n,i){var r=ticketManager.getWidgetByUid(i);if(!r.isContentAttached){r.isContentAttached=!0;var o="widget"+i,c=ticketManager.createWidgetFrame(o,a,n);c.src=t,r.parentNode.insertBefore(c,r)}},setWidget:function(e,t,a,n,i){var r=ticketManager.getWidgetByUid(i);if(!r.isContentAttached){r.isContentAttached=!0;var o="widget"+i,c=ticketManager.createWidgetFrame(o,a,n);r.parentNode.insertBefore(c,r),ticketManager.renderIframe(o,t)}},applyWidgetViewStat:function(e){var t="widgets="+encodeURIComponent(e),a=ticketManager.getSSLBaseDomain();(new Image).src=a+"widgetstat/?"+t},renderIframe:function(e,t){for(var a=0;a<window.frames.length;a++)try{if(window.frames[a].frameElement.name==e){window.frames[a].frameElement.style.display="",window.frames[a].document.write(t),window.frames[a].document.close();break}}catch(e){}},createWidgetFrame:function(e,t,a){var n=document.createElement("iframe");return n.name=e,n.style.width=isNaN(t)?t:t+"px",n.style.height=a+"px",n.className=e,n.allowTransparency=!0,n.frameBorder=0,n.style.border="none",n.scrolling="no",n},movieSchedule:function(e,t){ticketManager.openWidget(ticketManager.getRichKey(),e,t)},creationSchedule:function(e,t,a,n,i,r,o){ticketManager.Execute({Name:"command",Args:{Action:"Creation",ReturnURL:"",AdditionalParams:[{name:"WidgetKey",value:e},{name:"objectID",value:t},{name:"cityID",value:a},{name:"classID",value:n},{name:"filter",value:i},{name:"locale",value:r},{name:"cookie",value:ticketManager.environmentParams.authCookie}]},IsMobileVersionSupported:n!==ticketManager.SPORTEVENT_CLASS_ID,returnUrlCallBack:o})},closeWidget:function(){ticketManager.Execute({Name:"close"})},openWidget:function(e,t,a){ticketManager.Execute({Name:"command",Args:{Action:"Widget",ReturnURL:"",AdditionalParams:[{name:"WidgetKey",value:e},{name:"name",value:encodeURIComponent(t).replace("'","")},{name:"cityName",value:encodeURIComponent(a).replace("'","")},{name:"url",value:encodeURIComponent(window.location.href)},{name:"title",value:encodeURIComponent(document.title)},{name:"cookie",value:ticketManager.environmentParams.authCookie}]},IsMobileVersionSupported:!0})},openWidgetV2:function(e,t,a){ticketManager.openWidget(e,t,a)},hallPlan:function(e,t,a,n){ticketManager.Execute({Name:"command",Args:{Action:"HallPlan",ReturnURL:"",AdditionalParams:[{name:"WidgetKey",value:ticketManager.getRichKey()},{name:"cinemaID",value:e},{name:"movieID",value:t},{name:"time",value:a},{name:"cookie",value:ticketManager.environmentParams.authCookie}]},IsMobileVersionSupported:!0,returnUrlCallBack:n})},hallPlanV2:function(e,t,a,n){ticketManager.hallPlan(e,t,a,n)},cinemaSchedule:function(e,t){ticketManager.placeSchedule(e,t)},placeSchedule:function(e,t,a,n,i){ticketManager.Execute({Name:"command",Args:{Action:"CinemaSchedule",ReturnURL:"",AdditionalParams:[{name:"WidgetKey",value:e},{name:"cinemaID",value:t},{name:"url",value:encodeURIComponent(window.location.href)},{name:"title",value:encodeURIComponent(document.title)},{name:"filter",value:a},{name:"locale",value:n},{name:"cookie",value:ticketManager.environmentParams.authCookie}]},IsMobileVersionSupported:!0,returnUrlCallBack:i})},movieSession:function(e,t){ticketManager.session(e,t)},session:function(e,t,a,n){ticketManager.Execute({Name:"command",Args:{Action:"Session",ReturnURL:"",AdditionalParams:[{name:"WidgetKey",value:e},{name:"sessionID",value:t},{name:"url",value:encodeURIComponent(window.location.href)},{name:"title",value:encodeURIComponent(document.title)},{name:"locale",value:a},{name:"cookie",value:ticketManager.environmentParams.authCookie}]},IsMobileVersionSupported:!0,returnUrlCallBack:n})},sourceSession:function(e,t,a,n,i){ticketManager.Execute({Name:"command",Args:{Action:"Session",ReturnURL:"",AdditionalParams:[{name:"WidgetKey",value:e},{name:"SourceSessionID",value:t},{name:"PlaceID",value:a},{name:"url",value:encodeURIComponent(window.location.href)},{name:"title",value:encodeURIComponent(document.title)},{name:"locale",value:n},{name:"cookie",value:ticketManager.environmentParams.authCookie}]},IsMobileVersionSupported:!0,returnUrlCallBack:i})},richSession:function(e,t){ticketManager.session(ticketManager.getRichKey(),e,t)},sale:function(e){ticketManager.Execute({Name:"command",Args:{Action:"SaleComplete",ReturnURL:"",AdditionalParams:[{name:"OrderKey",value:e}]},IsMobileVersionSupported:!0})},pay:function(e){ticketManager.Execute({Name:"command",Args:{Action:"PayOrder",ReturnURL:"",AdditionalParams:[{name:"OrderKey",value:e}]},IsMobileVersionSupported:!0})},createAndPay:function(e,t){return ticketManager.Execute({Name:"command",Args:{Action:"CreateAndPayOrder",ReturnURL:"",AdditionalParams:[{name:"WidgetKey",value:e},{name:"PartnerOrderKey",value:t}]},IsMobileVersionSupported:!0}),ticketManager.getWidgetEventSubscription()},listWidget:function(e,t,a,n,i,r,o){var c={key:"",classId:"",cityId:"",filter:"",locale:"",version:"",startPage:""};c="string"==typeof e?{key:e,classId:t,cityId:a,filter:n,locale:i,version:r,startPage:o}:{key:e.key,classId:e.classId,cityId:e.cityId,filter:e.filter,locale:e.locale,version:e.version,startPage:e.startPage},ticketManager.Execute({Name:"command",Args:{Action:"ListWidget",ReturnURL:"",AdditionalParams:[{name:"WidgetKey",value:c.key},{name:"classId",value:c.classId},{name:"cityID",value:c.cityId},{name:"url",value:encodeURIComponent(window.location.href)},{name:"title",value:encodeURIComponent(document.title)},{name:"filter",value:c.filter},{name:"locale",value:c.locale},{name:"cookie",value:ticketManager.environmentParams.authCookie},{name:"Version",value:c.version},{name:"StartPage",value:c.startPage}]},IsMobileVersionSupported:!0})},store:function(e,t,a){ticketManager.Execute({Name:"command",Args:{Action:"Store",ReturnURL:"",AdditionalParams:[{name:"widgetKey",value:e},{name:"concessionId",value:t},{name:"concessionCount",value:a},{name:"url",value:encodeURIComponent(window.location.href)},{name:"cookie",value:ticketManager.environmentParams.authCookie}]},IsMobileVersionSupported:!0})},initDialogAndSetStyle:function(e,t){this.minWidth=736,this.minHeight=546,this.maxWidth=1330,this.maxHeight=1e3,e||(e=736),t||(t=546),ticketManager.InitDialog.apply(ticketManager,[e,t]),ticketManager.Execute({Name:"setStyle",Args:{width:e,height:t}})},addEvent:function(e,t,a){void 0!==e.attachEvent?e.attachEvent("on"+t,a):void 0!==e.addEventListener&&e.addEventListener(t,a,!1)},getRichKey:function(){var e=document.getElementsByTagName("rb:rich");if(e.length>0)return e[0].getAttribute("key")},load:function(){function e(e){e.origin+"/"!=ticketManager.getBaseDomain()&&e.origin+"/"!=ticketManager.getWidget2BaseDomain()&&e.origin+"/"!=ticketManager.getSSLBaseDomain()&&e.origin+"/"!=ticketManager.getWidget2SSLBaseDomain()||("kassa-widget-will-disappear"==e.data.id?ticketManager.Execute({Name:"hide"}):"kassa-widget-need-location-replace"==e.data.id?window.location.href=e.data.url:"kassa-widget-did-appear"==e.data.id?ticketManager.setEnvironmentParams():ticketManager.Execute(JSON.parse(e.data)))}if("object"==typeof TicketManager.instance)return TicketManager.instance;window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e);var t=document.getElementById("afishaWidgetContainer");t||((t=document.createElement("div")).setAttribute("id","afishaWidgetContainer"),t.innerHTML="",document.getElementsByTagName("body")[0].appendChild(t)),ticketManager.updateWidgets();var a=ticketManager.getUrlVar(ticketManager.orderKeyParam);ticketManager.dispatchEvent("ticketmanager.events.load"),TicketManager.instance=this,null!=a&&""!=a&&ticketManager.sale(a)},getTagsNames:function(){for(var e,t=new Array,a=0;a<arguments.length;a++){e=document.getElementsByTagName(arguments[a]);for(var n=0;n<e.length;n++)e[n].isScriptAttached||t.push(e[n])}return t},sortByWidgetID:function(e,t){var a=e.getAttribute("key"),n=t.getAttribute("key");return a<n?-1:a>n?1:0},globalWidgetUid:0,updateWidgets:function(){ticketManager.widgets=ticketManager.getTagsNames("rb:ticket","rb:movie","rb:cinema","rb:session","rb:schedule","rb:inline","rb:list","rb:inlinelist"),ticketManager.widgets.sort(ticketManager.sortByWidgetID);for(var e=ticketManager.getSSLBaseDomain(),t="",a=ticketManager.buildWidgetHandlerUrl(e),n="",i=0;i<ticketManager.widgets.length;i++){var r=ticketManager.widgets[i];if(!r.isScriptAttached){r.isScriptAttached=!0;var o=r.nodeName.toLowerCase(),c=r.getAttribute("key");r.Uid=ticketManager.globalWidgetUid++,""==n&&(n=c);var s=ticketManager.getWidgetParams(r,r.Uid,ticketManager.getAddWidgetFunc(o));t.length>0&&c==n?t+="|"+s:t+="@"+ticketManager.addParam("widgetkey",c)+s,(t+a).length>=ticketManager.maxRequestLength&&(ticketManager.addWidgetScript(t,a),t=""),n=c}}t.length>0&&ticketManager.addWidgetScript(t,a)},getAddWidgetFunc:function(e){return"rb:ticket"==e||"rb:movie"==e?ticketManager.addMovieWidgetParams:"rb:cinema"==e?ticketManager.addCinemaWidgetParams:"rb:session"==e?ticketManager.addSessionWidgetParams:"rb:schedule"==e?ticketManager.addScheduleWidgetParams:"rb:inline"==e?ticketManager.addScheduleWidgetParams:"rb:list"==e?ticketManager.addListWidgetParams:"rb:inlinelist"==e?ticketManager.addListWidgetParams:void 0},getWidgetParams:function(e,t,a){return a(e)+ticketManager.addParam("widgetIndex",t)},addCinemaWidgetParams:function(e){return ticketManager.getParamsFromAttrs(e,"cinemaID")},addSessionWidgetParams:function(e){return ticketManager.getParamsFromAttrs(e,"sessionID","locale")},addMovieWidgetParams:function(e){return ticketManager.getParamsFromAttrs(e,"cityID","movieID","cityName")+ticketManager.addParam("name",e.getAttribute("movieName"))},addScheduleWidgetParams:function(e){return ticketManager.getParamsFromAttrs(e,"cityID","objectID","classType","filter","locale")},addListWidgetParams:function(e){return ticketManager.getParamsFromAttrs(e,"cityID","classType","filter","locale")},getParamsFromAttrs:function(e){for(var t="",a=1;a<arguments.length;a++){var n=arguments[a];if(null!=e.getAttribute(n)&&""!=e.getAttribute(n)){var i=e.getAttribute(n);"filter"==n&&(i=ticketManager.base64encode(i)),t+=ticketManager.addParam(n,i)}}return t},addParam:function(e,t){return"{"+e+"}"+encodeURIComponent(ticketManager.prepareParam(t))},prepareParam:function(e){return null==e||"string"!=typeof e?e:e.replace(new RegExp("[{]|[}]|[|]|[@]|[,]","g"),"")},addWidgetScript:function(e,t){var a=document.createElement("script");a.type="text/javascript",a.src=t+"&widgetParams="+e,document.getElementsByTagName("body")[0].appendChild(a)},buildWidgetHandlerUrl:function(e){return e+"widgethandler/v4/?url="+encodeURIComponent(window.location.href)},getWidgetEventSubscription:function(){return{success:function(e){ticketManager.onClose.success=e},close:function(e){ticketManager.onClose.close=e}}},getCookie:function(e){var t,a,n,i=document.cookie.split(";");for(t=0;t<i.length;t++)if(a=i[t].substr(0,i[t].indexOf("=")),n=i[t].substr(i[t].indexOf("=")+1),(a=a.replace(/^\s+|\s+$/g,""))==e)return unescape(n);return null},getBaseDomain: function() {return 'https://widget.kassa.rambler.ru/'},getWidget2BaseDomain: function() {return 'https://w.kassa.rambler.ru/'},getStaticBase: function() {return 'https://widget.kassa.rambler.ru/'},getSSLBaseDomain: function() {return 'https://widget.kassa.rambler.ru/'},getWidget2SSLBaseDomain: function() {return 'https://w.kassa.rambler.ru/'},getSSLStaticBase: function() {return 'https://widget.kassa.rambler.ru/'},init:function(){var e=ticketManager.getSSLBaseDomain();ticketManager.FrameID="afishaWidgetContainer",ticketManager.CommandURL=e+"CrossDomainInteraction/DoCommand",ticketManager.CommandURLWidget=e+"CrossDomainInteraction/WidgetUrl",ticketManager.ReturnURL=window.location.href,window.addEventListener?"loading"!==document.readyState?setTimeout(ticketManager.load,0):window.addEventListener("DOMContentLoaded",ticketManager.load,!1):window.attachEvent&&window.attachEvent("onload",ticketManager.load)},dispatchEvent:function(e){var t;document.createEvent?(t=document.createEvent("Events")).initEvent(e,!0,!0):((t=document.createEventObject()).type="propertychange",t.propertyName=e),document.createEvent?document.dispatchEvent(t):document.fireEvent("onpropertychange",t)},base64encode:function(e){for(var t,a,n,i,r,o,c,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d="",g=0;g<e.length;)t=e.charCodeAt(g++),a=e.charCodeAt(g++),n=e.charCodeAt(g++),i=t>>2,r=(3&t)<<4|a>>4,o=isNaN(a)?64:(15&a)<<2|n>>6,c=isNaN(n)?64:63&n,d+=s.charAt(i)+s.charAt(r)+s.charAt(o)+s.charAt(c);return d},setUtmParameters:function(e){ticketManager.utmParameters=e,ticketManager.ReturnURL=window.location.origin+window.location.pathname+ticketManager.getSearchWithUtm()+window.location.hash},clearLocationSearch:function(){return window.location.search.replace("?","").split("&").map(function(e){return-1===e.indexOf("utm")&&""!==e?"&"+e:""}).join("")},getSearchWithUtm:function(){return ticketManager.utmParameters&&ticketManager.utmParameters.source?"?utm_source="+ticketManager.utmParameters.source+(ticketManager.utmParameters.medium?"&utm_medium="+ticketManager.utmParameters.medium:"")+(ticketManager.utmParameters.campaign?"&utm_campaign="+ticketManager.utmParameters.campaign:"")+(ticketManager.utmParameters.term?"&utm_term="+ticketManager.utmParameters.term:"")+(ticketManager.utmParameters.content?"&utm_content="+ticketManager.utmParameters.content:"")+ticketManager.clearLocationSearch():window.location.search},throwCookie:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));ticketManager.environmentParams.authCookie=t?decodeURIComponent(t[1]):void 0},setEnvironmentParams:function(){}};var ticketManager=new TicketManager;ticketManager.init();
